---
sidebar: sidebar 
permalink: Management.System_Administration.clone_virtual_machines.html 
summary: 虛擬機器複製 
keywords:  
---
= 複製虛擬機器
:allow-uri-read: 




== 總覽

虛擬桌面服務（VDS）可讓您複製現有的虛擬機器（VM）。這項功能可在定義的使用者數增加時自動增加伺服器單元數可用度、或是在可用的資源集區中增加其他伺服器。

管理員在VDS中使用複製的方式有兩種：

. 隨需從現有用戶端伺服器自動建立新伺服器
. 主動自動建立新的用戶端伺服器、以根據合作夥伴定義和控制的規則自動擴充資源




== 複製以新增其他共用伺服器

複本是現有虛擬機器的複本。複製功能可節省時間、並協助管理員擴充規模、因為安裝客體作業系統和應用程式可能相當耗時。有了複本、您就能從單一安裝與組態程序建立多個虛擬機器複本。這種情況通常如下：

. 在TS或TSD伺服器上安裝所有所需的應用程式和設定
. 瀏覽至：「Workspace（工作區）」>「Servers Section（伺服器區段）」>「Gear（來源伺服器的齒輪）」圖示>
. 允許執行複製程序（一般為45-90分鐘）
. 最後一個步驟會啟動複製的伺服器、並將其放入RDS集區以接受新的連線。複製的伺服器在複製之後可能需要個別的組態、因此VDS會等待系統管理員手動將伺服器旋轉。


視需要重複多次。image:Cloning-Servers.gif[""]

.若要增加共用工作階段主機環境中的使用者容量、複製工作階段主機是一項簡單的程序、只需幾個步驟即可完成。
. 選取要複製的工作階段主機、確認目前沒有使用者登入機器。
. 在VDS中、瀏覽至目標用戶端的工作區。捲動至伺服器區段、按一下齒輪圖示、然後選取複製。此程序需要大量時間、並將來源機器離線。預計完成時間超過30分鐘。
+
image:clone1.png[""]
image:clone2.png[""]

. 此程序會關閉伺服器、將伺服器複製到另一個映像、並將映像複製到客戶的下一個Ts#。伺服器會在「伺服器」清單中顯示「_Type =分段_」和「_Status =需要啟動_」。
+
image:clone3.png[""]

. 登入伺服器、確認伺服器已準備就緒可供正式作業。
+
image:clone4.png[""]

. 準備好之後、按一下「啟動」、將伺服器新增至工作階段主機集區、以開始接受使用者連線。
+
image:clone5.png[""]





== VDS複製程序定義

任何Clone Server作業下的VDS > Deployment > Task History（VDS >部署>任務歷史記錄）中都會詳細說明逐步程序。此程序有20多個步驟、從存取Hypervisor開始、開始複製程序、最後啟動複製的伺服器。複製程序包括下列重要步驟：

* 設定DNS並設定伺服器名稱
* 指派靜態IP
* 新增至網域
* 更新Active Directory
* 更新VDS DB（CWMGR1上的SQL執行個體）
* 建立複本的防火牆規則


除了「工作歷程記錄」之外、任何複製程序的詳細步驟都可在每個合作夥伴的「虛擬桌面部署」中、於CwVmAutomationService登入CWMGR1檢視。檢閱這些記錄檔已記錄下來 link:Troubleshooting.reviewing_vds_logs.html["請按這裡"]。



== 自動建立新伺服器

這項VDS功能的設計旨在隨著定義的使用者數量增加、自動提高伺服器單元數可用度。

合作夥伴透過VDS（link:https://manage.cloudworkspace.com[""]）>用戶端>總覽–VM資源>自動擴充。有幾項控制措施可供合作夥伴啟用/停用自動擴充功能、並為每個用戶端建立自訂規則、例如：數量/使用者/伺服器、每個使用者額外的RAM、以及每個CPU的使用者數量。


NOTE: 以上假設已針對整個虛擬桌面部署啟用自動複製。例如、若要停止所有自動複製、請使用「進階」視窗中的「DCConfig」、取消核取「伺服器建立」->「啟用自動複製」。



=== 自動化複製程序何時執行？

自動複製程序會在每日維護設定為執行時執行。預設值為午夜、但可以編輯。日常維護的一部分是針對每個資源池執行變更資源執行緒。「變更資源」執行緒會根據集區組態的使用者人數（可自訂、每部伺服器可為10、21、30等使用者）來決定所需的共用伺服器數量。



== 自動建立新伺服器的「隨需」功能

此VDS功能可自動「隨需」複製其他伺服器至可用資源集區。

VDS管理會登入VDS、並在「組織或工作區模組」下找到特定的「用戶端」、然後開啟「總覽」索引標籤。「Servers Tile（伺服器區塊）」會列出所有伺服器（TSD1、TS1、D1等）。若要複製任何個別伺服器、只要按一下伺服器名稱最右側的cog、然後選取Clone（複製）選項即可。

一般而言、此程序需要約一小時的時間。不過、持續時間取決於VM的大小和基礎Hypervisor的可用資源。請注意、所複製的伺服器必須重新開機、因此合作夥伴通常會在下班後或排程維護期間執行。

當複製TSDData伺服器時，其中一個步驟是刪除c：\Home、c：\Data和c：\Pro資料夾，使它們不會有任何重複的檔案。在此情況下、複製程序失敗、刪除這些檔案時發生問題。這個錯誤很模糊。通常、這表示複製事件因為有開啟的檔案或程序而失敗。下次嘗試時、請停用任何AV（因為這可能會說明此錯誤）。
